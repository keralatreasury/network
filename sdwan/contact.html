<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Treasuries – Admin Contacts (SD‑WAN)</title>
    <!-- Bootstrap & DataTables -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- jQuery & DataTables -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <style>
        body {
            background-color: #f0f5fa;
            padding: 24px;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
        }
        .main-wrapper {
            max-width: 1400px;
            margin: 0 auto;
        }
        .page-header {
            background: linear-gradient(135deg, #0f5b9c 0%, #1a4b7a 100%);
            color: white;
            padding: 20px 28px;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            margin-bottom: 2px;
        }
        .card-db {
            background: white;
            border-radius: 0 0 20px 20px;
            padding: 28px;
            box-shadow: 0 10px 30px rgba(0,20,40,0.12);
            border: none;
        }
        .section-badge {
            background: #e3f2fd;
            color: #0f5b9c;
            padding: 8px 20px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 24px;
            border-left: 5px solid #0f5b9c;
        }
        .table thead th {
            background-color: #1a4b7a;
            color: white;
            font-weight: 500;
            font-size: 0.9rem;
            vertical-align: middle;
            white-space: nowrap;
            padding: 14px 10px;
            border-right: 1px solid #2d5f8a;
        }
        .table thead th:last-child { border-right: none; }
        .table td {
            padding: 12px 10px;
            vertical-align: middle;
            font-size: 0.9rem;
        }
        .table tbody tr:hover { background-color: #f1f9ff; }
        .contact-link {
            color: #0f5b9c;
            text-decoration: none;
            font-weight: 500;
        }
        .contact-link:hover {
            text-decoration: underline;
            color: #093b61;
        }
        .empty-cell {
            color: #8a9fb0;
            font-style: italic;
        }
        .dataTables_wrapper .dataTables_length select,
        .dataTables_wrapper .dataTables_filter input {
            border: 1px solid #cbd5e0;
            border-radius: 10px;
            padding: 6px 12px;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: #0f5b9c !important;
            color: white !important;
            border: none;
            border-radius: 8px;
        }
        .footer-note {
            margin-top: 20px;
            background: #e8f0f7;
            padding: 14px 22px;
            border-radius: 16px;
            color: #1e405e;
            font-size: 0.95rem;
            border-left: 6px solid #0f5b9c;
        }
    </style>
</head>
<body>
<div class="main-wrapper">
    <!-- header identical to original flavour -->
    <div class="page-header d-flex align-items-center">
        <i class="bi bi-person-lines-fill fs-2 me-3"></i>
        <div>
            <h2 class="fw-bold mb-0">All Treasuries – Admin Contact Details</h2>
          
        </div>
    </div>

    <!-- main card -->
    <div class="card-db">
    

        <!-- table container -->
        <div class="table-responsive">
            <table id="adminFullTable" class="table table-hover table-striped" style="width:100%">
                <thead>
                <tr>
                    <th>Treasury / Location</th>
                    <th>Network Admin Name</th>
                    <th>Network Admin Contact</th>
                    <th>Treasury Admin Name</th>
                    <th>Treasury Admin Contact</th>
                    <th>Office Mail ID</th>
                    <th>Office Contact</th>
                    <th>Office Mobile</th>
                </tr>
                </thead>
                <tbody>
                <!-- filled via javascript -->
                <tr><td colspan="8" class="text-center py-5"><div class="spinner-border text-primary" role="status"></div> loading admin contacts ...</td></tr>
                </tbody>
            </table>
        </div>

    
    </div>
</div>

<script>
    (function() {
        // ----------------------------------------------
        // CONFIG – same as original dashboard
        // ----------------------------------------------
        const API_KEY = 'AIzaSyBB1V3vJpNZ9X1GIF-YOwoa6YSt_iXMLo0';
        const SPREADSHEET_ID = '1HvCqLHC8IyllKskBXX1MtMfjQMGUyhMP7KuTuJxDhmU';
        const SHEET_ADMIN = 'Admin Contact Details';
        
        // we directly fetch the exact range A2:H (no headers row)
        const RANGE = 'A2:H';   // as used in original loadAdminSheet()

        let adminRows = [];      // will hold raw arrays (each length ≤8)

        // ----------------------------------------------
        // fetch data and init DataTable
        // ----------------------------------------------
        function loadAllAdminContacts() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(SHEET_ADMIN)}!${RANGE}?key=${API_KEY}`;

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if (data.values && data.values.length > 0) {
                        adminRows = data.values;
                    } else {
                        adminRows = []; // no data
                    }
                    renderTable(adminRows);
                })
                .catch(err => {
                    console.error('Error loading admin sheet:', err);
                    document.querySelector('#adminFullTable tbody').innerHTML = `
                        <tr><td colspan="8" class="text-center py-5 text-danger">
                            <i class="bi bi-exclamation-triangle-fill fs-3"></i><br>
                            Failed to load data. Check API key / permissions.
                        </td></tr>`;
                });
        }

        // ----------------------------------------------
        // render DataTable with all rows (no filtering)
        // ----------------------------------------------
        function renderTable(rows) {
            const tbody = document.querySelector('#adminFullTable tbody');
            if (!rows || rows.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8" class="text-center py-5">
                    <i class="bi bi-inbox fs-1 text-muted"></i><br>
                    <span class="fs-5">No admin contact records found</span><br>
                    <small class="text-secondary">sheet range A2:H is empty</small>
                </td></tr>`;
                // destroy if any datatable instance exists
                if ($.fn.DataTable.isDataTable('#adminFullTable')) {
                    $('#adminFullTable').DataTable().destroy();
                }
                return;
            }

            // build html rows
            let htmlRows = '';
            for (let r = 0; r < rows.length; r++) {
                const row = rows[r];
                // ensure we have 8 columns (pad if needed, but sheet usually has less)
                const cols = [];
                for (let i = 0; i < 8; i++) {
                    cols[i] = (row[i] !== undefined && row[i] !== null) ? row[i].toString().trim() : '';
                }

                // helper to format contacts as links
                const formatContact = (val, type) => {
                    if (!val) return '<span class="empty-cell">—</span>';
                    const escaped = escapeHtml(val);
                    if (type === 'email' && val.includes('@')) {
                        return `<a href="mailto:${escapeHtml(val)}" class="contact-link">${escaped}</a>`;
                    } else if (type === 'phone') {
                        // strip non-digits for tel, but keep display
                        const digits = val.replace(/[^0-9+]/g, '');
                        if (digits) {
                            return `<a href="tel:${escapeHtml(digits)}" class="contact-link">${escaped}</a>`;
                        }
                    }
                    return escaped; // plain text
                };

                // column classification:
                // 0 treasury (no link), 1 network admin name, 2 network admin contact (phone),
                // 3 treasury admin name, 4 treasury admin contact (phone),
                // 5 office mail (email), 6 office contact (phone), 7 office mobile (phone)
                const treasury    = escapeHtml(cols[0] || '—');
                const netName     = escapeHtml(cols[1] || '—');
                const netPhone    = formatContact(cols[2], 'phone');
                const treasuryName= escapeHtml(cols[3] || '—');
                const treasuryPhone= formatContact(cols[4], 'phone');
                const officeEmail = formatContact(cols[5], 'email');
                const officeLand  = formatContact(cols[6], 'phone');
                const officeMobile= formatContact(cols[7], 'phone');

                htmlRows += `<tr>
                    <td><strong>${treasury}</strong></td>
                    <td>${netName}</td>
                    <td>${netPhone}</td>
                    <td>${treasuryName}</td>
                    <td>${treasuryPhone}</td>
                    <td>${officeEmail}</td>
                    <td>${officeLand}</td>
                    <td>${officeMobile}</td>
                </tr>`;
            }

            tbody.innerHTML = htmlRows;

            // (re)initialise DataTable
            if ($.fn.DataTable.isDataTable('#adminFullTable')) {
                $('#adminFullTable').DataTable().destroy();
            }
            $('#adminFullTable').DataTable({
                paging: true,
                pageLength: 25,
                lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, 'All']],
                ordering: true,
                responsive: false,
                scrollX: true,
                autoWidth: false,
                language: {
                    search: '<i class="bi bi-search"></i> Search',
                    searchPlaceholder: 'treasury, name, email...'
                },
                columnDefs: [
                    { targets: 0, width: '200px' },
                    { targets: 1, width: '160px' },
                    { targets: 2, width: '140px' },
                    { targets: 3, width: '160px' },
                    { targets: 4, width: '140px' },
                    { targets: 5, width: '190px' },
                    { targets: 6, width: '120px' },
                    { targets: 7, width: '130px' }
                ]
            });
        }

        // ----------------------------------------------
        // escape util (copied from original)
        // ----------------------------------------------
        function escapeHtml(text) {
            if (text === undefined || text === null) return '—';
            if (typeof text !== 'string') text = String(text);
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // start loading
        loadAllAdminContacts();
    })();
</script>

<!-- optional: if you want select2 style but not needed for plain table -->
</body>
</html>